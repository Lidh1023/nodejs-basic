# ğŸš€ æ‰‹æŠŠæ‰‹æ•™ç¨‹ï¼š10åˆ†é’Ÿæ­å»ºä½ çš„ä¸“å± AI èŠå¤©åŠ©æ‰‹ (Node.js ç‰ˆ)

æƒ³æ‹¥æœ‰ä¸€ä¸ªå±äºè‡ªå·±çš„ã€ç±»ä¼¼ ChatGPT çš„ AI èŠå¤©ç½‘é¡µå—ï¼Ÿ
æœ¬æ•™ç¨‹å°†å¸¦ä½ ä½¿ç”¨æœ€åŸºç¡€çš„ **Node.js** å’Œ **HTML**ï¼Œä¸ä¾èµ–å¤æ‚çš„æ¡†æ¶ï¼ˆå¦‚ Vue/React æˆ– Expressï¼‰ï¼Œä»é›¶å¼€å§‹æ­å»ºä¸€ä¸ªæ”¯æŒ**æ‰“å­—æœºæµå¼å›å¤**çš„èŠå¤©åº”ç”¨ã€‚

é€‚åˆäººç¾¤ï¼šå…·å¤‡åŸºç¡€ç¼–ç¨‹çŸ¥è¯†ï¼Œæƒ³äº†è§£ AI åº”ç”¨åº•å±‚åŸç†çš„å¼€å‘è€…æˆ–çˆ±å¥½è€…ã€‚

---

## ğŸ› ï¸ ç¬¬ä¸€æ­¥ï¼šç¯å¢ƒå‡†å¤‡ä¸åˆå§‹åŒ–

é¦–å…ˆï¼Œç¡®ä¿ä½ çš„ç”µè„‘ä¸Šå·²ç»å®‰è£…äº† [Node.js](https://nodejs.org/) (å»ºè®® v18 æˆ–æ›´é«˜ç‰ˆæœ¬)ã€‚

1.  **åˆ›å»ºé¡¹ç›®æ–‡ä»¶å¤¹**
    åœ¨ä½ çš„ç”µè„‘ä¸Šæ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œä¾‹å¦‚ `my-ai-chat`ï¼Œç„¶ååœ¨ç»ˆç«¯ï¼ˆå‘½ä»¤è¡Œï¼‰ä¸­è¿›å…¥è¯¥ç›®å½•ï¼š
    ```bash
    mkdir my-ai-chat
    cd my-ai-chat
    ```

2.  **åˆå§‹åŒ–é¡¹ç›®**
    è¿è¡Œä»¥ä¸‹å‘½ä»¤ç”Ÿæˆ `package.json` é…ç½®æ–‡ä»¶ï¼š
    ```bash
    npm init -y
    ```

3.  **ä¿®æ”¹é¡¹ç›®ç±»å‹**
    æ‰“å¼€ç”Ÿæˆçš„ `package.json` æ–‡ä»¶ï¼Œåœ¨é‡Œé¢æ·»åŠ ä¸€è¡Œ `"type": "module"`, è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ç°ä»£çš„ `import` è¯­æ³•äº†ã€‚
    ```json
    {
      "name": "my-ai-chat",
      "version": "1.0.0",
      "type": "module",  // <--- æ·»åŠ è¿™ä¸€è¡Œ
      ...
    }
    ```

4.  **å®‰è£…å¿…è¦ä¾èµ–**
    æˆ‘ä»¬éœ€è¦ä¸¤ä¸ªåº“ï¼š`openai` (ç”¨äºè¿æ¥ AI æ¨¡å‹) å’Œ `dotenv` (ç”¨äºå®‰å…¨ç®¡ç†å¯†é’¥)ã€‚
    ```bash
    npm install openai dotenv
    ```

---

## ğŸ”‘ ç¬¬äºŒæ­¥ï¼šå‡†å¤‡ API å¯†é’¥

æœ¬é¡¹ç›®ä½¿ç”¨ DeepSeekï¼ˆæ·±åº¦æ±‚ç´¢ï¼‰çš„å¤§æ¨¡å‹èƒ½åŠ›ã€‚

ğŸ‘‰ **æŒ‡å¼•**ï¼šè¯·å‰å¾€ [DeepSeek å¼€æ”¾å¹³å°](https://platform.deepseek.com/) æ³¨å†Œè´¦å·å¹¶åˆ›å»º API Key å³å¯ã€‚

æ‹¿åˆ°ä»¥ `sk-` å¼€å¤´çš„å¯†é’¥åï¼Œåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º `.env` çš„æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š
```env
DEEPSEEK_API_KEY=ä½ çš„å¯†é’¥ç²˜è´´åœ¨è¿™é‡Œ
PORT=3000
```

---

## ğŸ–¥ï¸ ç¬¬ä¸‰æ­¥ï¼šç¼–å†™åç«¯ (Server)

æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ï¼Œå®ƒè´Ÿè´£æ¥æ”¶ä½ çš„é—®é¢˜ï¼Œè½¬å‘ç»™ DeepSeekï¼Œç„¶åæŠŠ AI çš„å›ç­”ä¸€ç‚¹ä¸€ç‚¹â€œæµâ€å›ç»™æµè§ˆå™¨ã€‚

åˆ›å»ºæ–‡ä»¶å¤¹ `src`ï¼Œå¹¶åœ¨å…¶ä¸­æ–°å»ºæ–‡ä»¶ `server.js`ï¼Œå¡«å…¥ä»¥ä¸‹ä»£ç ï¼š

```javascript
// src/server.js
import http from "node:http";
import OpenAI from "openai";
import dotenv from "dotenv";
import { readFile } from "node:fs/promises";

// è¯»å– .env ä¸­çš„é…ç½®
dotenv.config();

// åˆå§‹åŒ– AI å®¢æˆ·ç«¯
const client = new OpenAI({
  apiKey: process.env.DEEPSEEK_API_KEY,
  baseURL: "https://api.deepseek.com/v1", // DeepSeek çš„ API åœ°å€
});

// è¾…åŠ©å‡½æ•°ï¼šå‘é€æµå¼æ•°æ®
function sendJson(res, type, content) {
  res.write(JSON.stringify({ type, content }) + "\n");
}

const server = http.createServer(async (req, res) => {
  const url = new URL(req.url, `http://${req.headers.host}`);

  // 1. æä¾›å‰ç«¯é¡µé¢
  if (req.method === "GET" && (url.pathname === "/" || url.pathname === "/chat.html")) {
    try {
      const html = await readFile(new URL("./chat.html", import.meta.url));
      res.writeHead(200, { "Content-Type": "text/html" });
      res.end(html);
    } catch {
      res.statusCode = 404;
      res.end("Not Found");
    }
    return;
  }

  // 2. å¤„ç†èŠå¤©æ¥å£
  if (req.method === "POST" && url.pathname === "/api/chat") {
    // è¯»å–ç”¨æˆ·å‘é€çš„æ¶ˆæ¯
    let body = "";
    for await (const chunk of req) body += chunk;
    const { message } = JSON.parse(body || "{}");

    // è®¾ç½®å“åº”å¤´ï¼šå‘Šè¯‰æµè§ˆå™¨æˆ‘ä»¬è¦å‘é€æµå¼æ•°æ®
    res.writeHead(200, {
      "Content-Type": "application/json",
      "Connection": "keep-alive",
      "Cache-Control": "no-cache",
    });

    try {
      // è°ƒç”¨ DeepSeek API
      const stream = await client.chat.completions.create({
        model: "deepseek-chat",
        messages: [
          { role: "system", content: "ä½ æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„AIåŠ©æ‰‹ã€‚" },
          { role: "user", content: message },
        ],
        stream: true, // å¼€å¯æµå¼æ¨¡å¼
      });

      // å®æ—¶æ¥æ”¶ AI çš„å›ç­”å¹¶è½¬å‘ç»™å‰ç«¯
      for await (const chunk of stream) {
        const content = chunk.choices[0]?.delta?.content || "";
        if (content) sendJson(res, "message", content);
      }
    } catch (error) {
      console.error(error);
      sendJson(res, "error", "å‡ºé”™äº†ï¼Œè¯·ç¨åå†è¯•");
    } finally {
      sendJson(res, "done", "[DONE]");
      res.end();
    }
    return;
  }

  res.statusCode = 404;
  res.end("Not Found");
});

const PORT = process.env.PORT || 3000;
server.listen(PORT, () => {
  console.log(`Server is running at http://localhost:${PORT}`);
});
```

---

## ğŸ¨ ç¬¬å››æ­¥ï¼šç¼–å†™å‰ç«¯ (UI)

ç°åœ¨æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ¼‚äº®çš„ç•Œé¢æ¥èŠå¤©ã€‚åœ¨ `src` æ–‡ä»¶å¤¹ä¸‹æ–°å»º `chat.html`ã€‚

è¿™æ˜¯ä¸€ä¸ªåŒ…å« HTMLã€CSS å’Œ JS çš„å®Œæ•´å•æ–‡ä»¶ï¼š

```html
<!-- src/chat.html -->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æˆ‘çš„ AI åŠ©æ‰‹</title>
  <style>
    /* ç®€å•çš„æ ·å¼ç¾åŒ– */
    body { margin: 0; font-family: sans-serif; background: #f0f2f5; display: flex; justify-content: center; height: 100vh; }
    .container { width: 100%; max-width: 800px; background: white; display: flex; flex-direction: column; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    .chat-box { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; }
    .msg { max-width: 80%; padding: 10px 15px; border-radius: 10px; line-height: 1.5; word-wrap: break-word; }
    .msg.user { align-self: flex-end; background: #007bff; color: white; }
    .msg.assistant { align-self: flex-start; background: #e9ecef; color: #333; }
    .input-area { padding: 20px; border-top: 1px solid #eee; display: flex; gap: 10px; }
    textarea { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 5px; resize: none; height: 50px; }
    button { padding: 0 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
    button:disabled { background: #ccc; }
  </style>
</head>
<body>
  <div class="container">
    <div class="chat-box" id="chat">
      <div class="msg assistant">ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„ AI åŠ©æ‰‹ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®ä½ çš„å—ï¼Ÿ</div>
    </div>
    <div class="input-area">
      <textarea id="input" placeholder="è¾“å…¥ä½ çš„é—®é¢˜..."></textarea>
      <button id="send">å‘é€</button>
    </div>
  </div>

  <script>
    const chatEl = document.getElementById('chat');
    const inputEl = document.getElementById('input');
    const sendBtn = document.getElementById('send');

    // æ·»åŠ æ¶ˆæ¯åˆ°å±å¹•
    function addMsg(role, text) {
      const div = document.createElement('div');
      div.className = `msg ${role}`;
      div.textContent = text;
      chatEl.appendChild(div);
      chatEl.scrollTop = chatEl.scrollHeight;
      return div;
    }

    // å‘é€æ¶ˆæ¯çš„ä¸»é€»è¾‘
    async function sendMessage() {
      const text = inputEl.value.trim();
      if (!text) return;

      // 1. æ˜¾ç¤ºç”¨æˆ·æ¶ˆæ¯
      addMsg('user', text);
      inputEl.value = '';
      sendBtn.disabled = true;

      // 2. åˆ›å»º AI å›å¤çš„å ä½æ°”æ³¡
      const aiMsgEl = addMsg('assistant', '');

      try {
        // 3. å‘èµ·è¯·æ±‚
        const res = await fetch('/api/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ message: text })
        });

        // 4. è¯»å–æµå¼å“åº”
        const reader = res.body.getReader();
        const decoder = new TextDecoder();
        let buffer = '';

        while (true) {
          const { value, done } = await reader.read();
          if (done) break;
          
          // è§£ç æ•°æ®å—
          buffer += decoder.decode(value, { stream: true });
          const lines = buffer.split('\n');
          buffer = lines.pop(); // ä¿ç•™æœªå®Œæ•´çš„è¡Œ

          for (const line of lines) {
            if (!line.trim()) continue;
            try {
              const json = JSON.parse(line);
              if (json.type === 'message') {
                // ğŸŒŸ å…³é”®ï¼šå°†æ–°æ”¶åˆ°çš„æ–‡å­—è¿½åŠ åˆ°æ°”æ³¡ä¸­
                aiMsgEl.textContent += json.content;
                chatEl.scrollTop = chatEl.scrollHeight;
              }
            } catch (e) { console.error(e); }
          }
        }
      } catch (err) {
        aiMsgEl.textContent += " [è¯·æ±‚å¤±è´¥]";
      } finally {
        sendBtn.disabled = false;
      }
    }

    sendBtn.addEventListener('click', sendMessage);
  </script>
</body>
</html>
```

---

## ğŸš€ ç¬¬äº”æ­¥ï¼šå¯åŠ¨ä¸ä½“éªŒ

ä¸€åˆ‡å°±ç»ªï¼ç°åœ¨è®©æˆ‘ä»¬æŠŠæœåŠ¡è·‘èµ·æ¥ã€‚

1.  **å¯åŠ¨æœåŠ¡**
    åœ¨ç»ˆç«¯ä¸­è¿è¡Œï¼š
    ```bash
    node src/server.js
    ```
    å¦‚æœä½ çœ‹åˆ° `Server is running at http://localhost:3000`ï¼Œè¯´æ˜å¯åŠ¨æˆåŠŸäº†ï¼

2.  **æ‰“å¼€æµè§ˆå™¨**
    è®¿é—® [http://localhost:3000](http://localhost:3000)ã€‚

3.  **å¼€å§‹èŠå¤©**
    åœ¨è¾“å…¥æ¡†è¾“å…¥â€œè®²ä¸ªç¬‘è¯â€ï¼Œä½ ä¼šçœ‹åˆ° AI çš„å›å¤æ˜¯ä¸€ä¸ªå­—ä¸€ä¸ªå­—è¹¦å‡ºæ¥çš„ï¼Œè¿™å°±æ˜¯æµå¼å“åº”çš„é­…åŠ›ï¼

---

## ğŸ‰ æ€»ç»“

æ­å–œä½ ï¼ä½ å·²ç»æˆåŠŸæ­å»ºäº†ä¸€ä¸ªç°ä»£åŒ–çš„ AI èŠå¤©åº”ç”¨ã€‚

**åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä½ å­¦ä¼šäº†ï¼š**
1.  ä½¿ç”¨ **Node.js åŸç”Ÿæ¨¡å—** æ­å»º Web æœåŠ¡å™¨ã€‚
2.  è°ƒç”¨ **OpenAI SDK** (é€‚é… DeepSeek) è¿›è¡Œ AI å¯¹è¯ã€‚
3.  å®ç°åç«¯åˆ°å‰ç«¯çš„ **æµå¼æ•°æ®ä¼ è¾“ (Streaming)**ã€‚
4.  å‰ç«¯å¦‚ä½•è§£ææµæ•°æ®å¹¶å®æ—¶æ¸²æŸ“ã€‚

è¿™æ­£æ˜¯ç›®å‰å¸‚é¢ä¸Šå¤§å¤šæ•° AI äº§å“ï¼ˆå¦‚ ChatGPTï¼‰çš„æ ¸å¿ƒå®ç°åŸç†ã€‚å¿«å»å‘ä½ çš„æœ‹å‹å±•ç¤ºä½ çš„æˆæœå§ï¼
